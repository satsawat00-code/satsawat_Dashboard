<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPR & ETC Matching Dashboard (Mobile Responsive)</title>
    
    <!-- Libraries via CDN (Pinned Versions for Stability) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.3/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Font: Noto Sans Thai -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        /* Tighter table for ETC */
        .table-compact th, .table-compact td { padding-left: 0.25rem; padding-right: 0.25rem; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- ICONS ---
        const IconActivity = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const IconCheckCircle = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const IconBarChart3 = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>;
        const IconCheck = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg>;
        const IconX = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>;
        const IconUpload = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const IconFileText = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>;
        const IconFilter = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>;
        const IconInfo = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const IconGithub = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>;
        const IconMenu = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="18" y2="18"/></svg>;

        // --- UTILITIES ---
        const parseThaiDate = (dateStr) => {
            if (!dateStr || typeof dateStr !== 'string') return null;
            const parts = dateStr.split('/');
            if (parts.length !== 3) return null;
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; 
            const yearBE = parseInt(parts[2], 10);
            const yearAD = yearBE - 543;
            return new Date(yearAD, month, day);
        };

        const parseInputDate = (dateStr) => {
            if (!dateStr) return null;
            const [y, m, d] = dateStr.split('-').map(Number);
            return new Date(y, m - 1, d);
        };

        const isWeekend = (date) => {
            const day = date.getDay();
            return day === 0 || day === 6; 
        };

        const CustomAxisTick = (props) => {
            const { x, y, payload } = props;
            const dateObj = parseThaiDate(payload.value);
            const isHoliday = dateObj ? isWeekend(dateObj) : false;
            return (
                <g transform={`translate(${x},${y})`}>
                    <text x={0} y={0} dy={16} textAnchor="middle" fill={isHoliday ? "#ef4444" : "#64748b"} fontSize={10} fontWeight={isHoliday ? "bold" : "normal"}>
                        {payload.value}
                    </text>
                </g>
            );
        };

        const getFormattedVal = (fieldElement) => {
            if (!fieldElement) return null;
            const fmtTag = fieldElement.getElementsByTagName('FormattedValue')[0];
            if (fmtTag && fmtTag.textContent !== undefined) return fmtTag.textContent.trim();
            const valTag = fieldElement.getElementsByTagName('Value')[0];
            if (valTag && valTag.textContent !== undefined) return valTag.textContent.trim();
            return null;
        };

        const parseNum = (str) => {
            if (!str) return 0;
            const cleanStr = str.replace(/,/g, '');
            const num = parseFloat(cleanStr);
            return isNaN(num) ? 0 : num;
        };

        // --- XML PARSER ---
        const parseXMLData = (xmlText, type) => {
            let cleanText = xmlText;
            const rootCloseTag = "</CrystalReport>";
            const closeIndex = cleanText.lastIndexOf(rootCloseTag);
            if (closeIndex !== -1) {
                cleanText = cleanText.substring(0, closeIndex + rootCloseTag.length);
            }
            cleanText = cleanText.replace(/xmlns="[^"]*"/g, "").replace(/xmlns:[a-zA-Z0-9]+="[^"]*"/g, "");
            cleanText = cleanText.replace(/xsi:schemaLocation\s*=\s*["'][^"']*["']/g, "");

            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(cleanText, "text/xml");
            const parserError = xmlDoc.getElementsByTagName("parsererror");
            
            if (parserError.length > 0) { 
                console.error("XML Parsing Error:", parserError[0].textContent);
                return []; 
            }

            const extractedData = [];
            const sections = xmlDoc.getElementsByTagName("Section");

            for (let i = 0; i < sections.length; i++) {
                const section = sections[i];
                const fields = section.getElementsByTagName("Field");
                if (fields.length === 0) continue;

                let rowRaw = {};
                let hasData = false;

                for (let j = 0; j < fields.length; j++) {
                    const field = fields[j];
                    const name = field.getAttribute("Name");
                    const value = getFormattedVal(field);
                    if (name && value !== null) { rowRaw[name] = value; hasData = true; }
                }

                if (hasData && rowRaw['date1']) { 
                    const dateObj = parseThaiDate(rowRaw['date1']);
                    if (type === 'LPR') {
                        const total = parseNum(rowRaw['total1']);
                        const auto = parseNum(rowRaw['autolpr1']);
                        const inputMatch = parseNum(rowRaw['inputlpr1']);
                        const inputPlaza = parseNum(rowRaw['inputplaza1']);
                        const pAuto = parseNum(rowRaw['percentautolpr1']); 
                        const pInputMatch = parseNum(rowRaw['percentinputlpr1']);
                        const pInputPlaza = parseNum(rowRaw['percentinputplaza1']);
                        const criteriaSum = pAuto + pInputMatch;
                        extractedData.push({
                            dateStr: rowRaw['date1'], dateObj,
                            lpr: { total, auto, pAuto, inputMatch, pInputMatch, inputPlaza, pInputPlaza, criteriaSum, passed: criteriaSum > 90.25 }
                        });
                    } else if (type === 'ETC') {
                        const total = parseNum(rowRaw['total1']);
                        const auto = parseNum(rowRaw['auto1']);
                        const inputEntry = parseNum(rowRaw['reserve1']); 
                        const autoLpr = parseNum(rowRaw['autolpr1']);
                        const inputLpr = parseNum(rowRaw['inputlpr1']);
                        const inputPlaza = parseNum(rowRaw['inputplaza1']);
                        const pAuto = parseNum(rowRaw['percentauto1']);
                        const pInputEntry = parseNum(rowRaw['percentreserve1']);
                        const pAutoLpr = parseNum(rowRaw['percentautolpr1']);
                        const pInputLpr = parseNum(rowRaw['percentinputlpr1']);
                        const pInputPlaza = parseNum(rowRaw['percentinputplaza1']);
                        const criteriaSum = pAuto + pInputEntry + pAutoLpr + pInputLpr;
                        extractedData.push({
                            dateStr: rowRaw['date1'], dateObj,
                            etc: { total, auto, pAuto, inputEntry, pInputEntry, autoLpr, pAutoLpr, inputLpr, pInputLpr, inputPlaza, pInputPlaza, criteriaSum, passed: criteriaSum > 98 }
                        });
                    } else if (type === 'EntryLPR' || type === 'ExitLPR') {
                        const total = parseNum(rowRaw['total1']);
                        const lprH = parseNum(rowRaw['lprh1']);
                        const lprHPercent = parseNum(rowRaw['lprhpercent1']);
                        const lprL = parseNum(rowRaw['lprl1']);
                        const lprLPercent = parseNum(rowRaw['lprlpercent1']);
                        const passed = lprHPercent > 95;

                        const entryObj = {
                            total, lprH, lprHPercent, lprL, lprLPercent, passed
                        };

                        if(type === 'EntryLPR') {
                             extractedData.push({ dateStr: rowRaw['date1'], dateObj, entryLpr: entryObj });
                        } else {
                             extractedData.push({ dateStr: rowRaw['date1'], dateObj, exitLpr: entryObj });
                        }
                    }
                }
            }
            return extractedData;
        }

        // --- SINGLE DAY INITIAL DATA ---
        function getInitialData() {
            const day1Date = "06/01/2569";
            const day1JsDate = new Date(2026, 0, 6);
            return [{
                id: day1Date,
                date: day1Date,
                jsDate: day1JsDate,
                etc: {
                    total: 93728, auto: 89129, pAuto: 95.09,
                    inputEntry: 713, pInputEntry: 0.76,
                    autoLpr: 84, pAutoLpr: 0.09,
                    inputLpr: 3569, pInputLpr: 3.81,
                    inputPlaza: 233, pInputPlaza: 0.25,
                    criteriaSum: 99.75, passed: true
                },
                lpr: {
                    total: 127473, auto: 119257, pAuto: 93.55,
                    inputMatch: 2412, pInputMatch: 1.89,
                    inputPlaza: 5804, pInputPlaza: 4.55,
                    criteriaSum: 95.44, passed: true
                },
                entryLpr: {
                    total: 235541, lprH: 228303, lprHPercent: 96.93, lprL: 7238, lprLPercent: 3.07, passed: true
                },
                exitLpr: {
                    total: 239478, lprH: 233956, lprHPercent: 97.69, lprL: 5522, lprLPercent: 2.31, passed: true
                }
            }];
        }

        // --- COMPONENTS ---
        function StatCard({ title, value, subValue, icon: Icon, colorClass, bgClass }) {
            return (
                <div className={`p-4 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow ${bgClass || 'bg-white'}`}>
                    <div className="flex items-start justify-between">
                        <div>
                            <p className="text-xs font-medium text-slate-500 mb-1 truncate">{title}</p>
                            <h3 className="text-xl font-bold text-slate-800">{value}</h3>
                            {subValue && <p className={`text-xs mt-1 font-medium ${colorClass}`}>{subValue}</p>}
                        </div>
                        <div className={`p-2 rounded-lg ${colorClass.replace('text-', 'bg-').replace('600', '100').replace('700', '100').replace('500','100').replace('orange', 'orange')}`}>
                            <Icon className={`w-5 h-5 ${colorClass}`} />
                        </div>
                    </div>
                </div>
            );
        }

        function StatusBadge({ passed }) {
            return (
                <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold ${passed ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>
                    {passed ? <IconCheck className="w-3 h-3" /> : <IconX className="w-3 h-3" />}
                    {passed ? 'Pass' : 'Fail'}
                </span>
            );
        }

        function CustomRechartsTooltip({ active, payload, label }) {
            if (active && payload && payload.length) {
                return (
                    <div className="bg-white p-3 border border-slate-200 shadow-lg rounded-lg text-xs z-50">
                        <p className="font-bold text-slate-700 mb-1">{label}</p>
                        {payload.map((entry, index) => (
                            <div key={index} className="flex items-center gap-2 mb-0.5">
                                <div className="w-2 h-2 rounded-full" style={{ backgroundColor: entry.color }} />
                                <span className="text-slate-600">{entry.name}:</span>
                                <span className="font-semibold ml-1">
                                    {entry.name.includes('%') || entry.name.includes('Score') 
                                        ? `${Number(entry.value).toFixed(2)}%` 
                                        : Number(entry.value).toLocaleString()}
                                </span>
                            </div>
                        ))}
                    </div>
                );
            }
            return null;
        }

        // Mobile Card View for Tables
        function MobileTableRowCard({ row, type }) {
             // For LPR Tab
             if (type === 'lpr') {
                 const item = row.lpr;
                 if (!item) return null;
                 return (
                    <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-100 mb-3 text-sm">
                        <div className="flex justify-between items-center mb-2 border-b pb-2">
                            <span className="font-bold text-slate-700">{row.date}</span>
                            <StatusBadge passed={item.passed} />
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                            <div className="text-slate-500">Total:</div>
                            <div className="text-right font-mono">{item.total.toLocaleString()}</div>
                            
                            <div className="text-purple-600 font-medium">Auto:</div>
                            <div className="text-right font-mono">{item.auto.toLocaleString()} ({item.pAuto.toFixed(2)}%)</div>
                            
                            <div className="text-teal-600 font-medium">Input LPR:</div>
                            <div className="text-right font-mono">{item.inputMatch.toLocaleString()} ({item.pInputMatch.toFixed(2)}%)</div>
                            
                            <div className="text-amber-600 font-medium">Plaza:</div>
                            <div className="text-right font-mono">{item.inputPlaza.toLocaleString()} ({item.pInputPlaza.toFixed(2)}%)</div>
                            
                            <div className="text-slate-800 font-bold pt-1">KPI Score:</div>
                            <div className="text-right font-bold text-slate-800 pt-1">{item.criteriaSum.toFixed(2)}%</div>
                        </div>
                    </div>
                 );
             }
             // For ETC Tab
             if (type === 'etc') {
                const item = row.etc;
                if (!item) return null;
                return (
                   <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-100 mb-3 text-sm">
                       <div className="flex justify-between items-center mb-2 border-b pb-2">
                           <span className="font-bold text-slate-700">{row.date}</span>
                           <StatusBadge passed={item.passed} />
                       </div>
                       <div className="grid grid-cols-2 gap-y-1 gap-x-2">
                           <div className="text-slate-500">Total:</div>
                           <div className="text-right font-mono">{item.total.toLocaleString()}</div>
                           
                           <div className="text-blue-600">Auto:</div>
                           <div className="text-right font-mono">{item.auto.toLocaleString()} ({item.pAuto.toFixed(2)}%)</div>

                           <div className="text-emerald-600">Handheld:</div>
                           <div className="text-right font-mono">{item.inputEntry.toLocaleString()} ({item.pInputEntry.toFixed(2)}%)</div>

                           <div className="text-orange-600">Auto LPR:</div>
                           <div className="text-right font-mono">{item.autoLpr.toLocaleString()} ({item.pAutoLpr.toFixed(2)}%)</div>
                           
                           <div className="text-indigo-600">In. LPR:</div>
                           <div className="text-right font-mono">{item.inputLpr.toLocaleString()} ({item.pInputLpr.toFixed(2)}%)</div>

                           <div className="text-gray-600">In. Plaza:</div>
                           <div className="text-right font-mono">{item.inputPlaza.toLocaleString()} ({item.pInputPlaza.toFixed(2)}%)</div>
                           
                           <div className="text-slate-800 font-bold pt-1 border-t mt-1">KPI:</div>
                           <div className="text-right font-bold text-slate-800 pt-1 border-t mt-1">{item.criteriaSum.toFixed(2)}%</div>
                       </div>
                   </div>
                );
             }
             // For Entry/Exit Tabs
             if (type === 'entry' || type === 'exit') {
                 const item = row[`${type}Lpr`];
                 if (!item) return null;
                 const isEntry = type === 'entry';
                 return (
                    <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-100 mb-3 text-sm">
                        <div className="flex justify-between items-center mb-2 border-b pb-2">
                            <span className="font-bold text-slate-700">{row.date}</span>
                            <StatusBadge passed={item.passed} />
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                            <div className="text-slate-500">Total:</div>
                            <div className="text-right font-mono">{item.total.toLocaleString()}</div>
                            
                            <div className={isEntry ? "text-emerald-600" : "text-emerald-600"}>&gt; 95%:</div>
                            <div className="text-right font-mono text-emerald-700">{item.lprH.toLocaleString()} ({item.lprHPercent.toFixed(2)}%)</div>
                            
                            <div className="text-rose-600">&lt; 95%:</div>
                            <div className="text-right font-mono text-rose-700">{item.lprL.toLocaleString()} ({item.lprLPercent.toFixed(2)}%)</div>
                        </div>
                    </div>
                 );
             }
             return null;
        }

        function Dashboard() {
            const [activeTab, setActiveTab] = useState('overview');
            const [dateRange, setDateRange] = useState({ start: '', end: '' });
            const [data, setData] = useState([]);
            const [etcRaw, setEtcRaw] = useState(null);
            const [lprRaw, setLprRaw] = useState(null);
            const [entryLprRaw, setEntryLprRaw] = useState(null);
            const [exitLprRaw, setExitLprRaw] = useState(null);
            const [isUsingRealData, setIsUsingRealData] = useState(false);
            const [rechartsLoaded, setRechartsLoaded] = useState(false);
            const [autoFetchStatus, setAutoFetchStatus] = useState('idle');
            const [isMobile, setIsMobile] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            useEffect(() => {
                if (window.Recharts) setRechartsLoaded(true);
                setData(getInitialData());

                const checkMobile = () => setIsMobile(window.innerWidth < 768);
                checkMobile();
                window.addEventListener('resize', checkMobile);

                // AUTO-FETCH LOGIC
                const tryAutoFetch = async () => {
                    setAutoFetchStatus('loading');
                    try {
                        const baseUrl = "https://raw.githubusercontent.com/satsawat00-code/satsawat_Dashboard/main/Data/";
                        const timestamp = new Date().getTime(); 
                        
                        const fileConfigs = [
                            { url: baseUrl + "LPR%20Matching.xml?t=" + timestamp, type: 'LPR' },
                            { url: baseUrl + "ETC%20Matching.xml?t=" + timestamp, type: 'ETC' },
                            { url: baseUrl + "Entry_LPR.xml?t=" + timestamp, type: 'EntryLPR' },
                            { url: baseUrl + "Exit_LPR.xml?t=" + timestamp, type: 'ExitLPR' }
                        ];

                        const results = await Promise.allSettled(
                            fileConfigs.map(async (config) => {
                                const response = await fetch(config.url);
                                if (!response.ok) throw new Error(`HTTP error ${response.status} for ${config.url}`);
                                const text = await response.text();
                                return { type: config.type, data: parseXMLData(text, config.type) };
                            })
                        );

                        let loadedAny = false;
                        results.forEach(res => {
                            if (res.status === 'fulfilled') {
                                const { type, data } = res.value;
                                if (data && data.length > 0) {
                                    loadedAny = true;
                                    if (type === 'LPR') setLprRaw(data);
                                    if (type === 'ETC') setEtcRaw(data);
                                    if (type === 'EntryLPR') setEntryLprRaw(data);
                                    if (type === 'ExitLPR') setExitLprRaw(data);
                                }
                            }
                        });

                        if (loadedAny) {
                            setAutoFetchStatus('success');
                            setIsUsingRealData(true); 
                        } else {
                            setAutoFetchStatus('error');
                        }

                    } catch (err) {
                        console.error("Auto fetch failed:", err);
                        setAutoFetchStatus('error');
                    }
                };
                
                tryAutoFetch();
                return () => window.removeEventListener('resize', checkMobile);
            }, []);

            const { 
                LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, 
                AreaChart, Area, ReferenceLine, ComposedChart, Rectangle 
            } = window.Recharts || {};

            const handleFileUpload = (event, type) => {
                const file = event.target.files[0];
                if (!file) return;
                event.target.value = ''; 
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        const parsed = parseXMLData(text, type);
                        if (parsed.length === 0) return;

                        if (type === 'ETC') { setEtcRaw(parsed); alert(`อัปโหลด ETC สำเร็จ: พบ ${parsed.length} รายการ`); }
                        if (type === 'LPR') { setLprRaw(parsed); alert(`อัปโหลด LPR สำเร็จ: พบ ${parsed.length} รายการ`); }
                        if (type === 'EntryLPR') { setEntryLprRaw(parsed); alert(`อัปโหลด Entry LPR สำเร็จ: พบ ${parsed.length} รายการ`); }
                        if (type === 'ExitLPR') { setExitLprRaw(parsed); alert(`อัปโหลด Exit LPR สำเร็จ: พบ ${parsed.length} รายการ`); }
                    } catch (err) {
                        console.error(err);
                        alert("เกิดข้อผิดพลาดในการอ่านไฟล์: " + err.message);
                    }
                };
                reader.readAsText(file);
            };

            // Merge Logic
            useEffect(() => {
                if (etcRaw || lprRaw || entryLprRaw || exitLprRaw) {
                    const mergedMap = new Map();
                    const allDates = new Set();
                    if (etcRaw) etcRaw.forEach(i => allDates.add(i.dateStr));
                    if (lprRaw) lprRaw.forEach(i => allDates.add(i.dateStr));
                    if (entryLprRaw) entryLprRaw.forEach(i => allDates.add(i.dateStr));
                    if (exitLprRaw) exitLprRaw.forEach(i => allDates.add(i.dateStr));

                    allDates.forEach(dStr => mergedMap.set(dStr, { dateStr: dStr, etc: null, lpr: null, entryLpr: null, exitLpr: null }));

                    const mergeData = (rawData, key) => {
                        if (rawData) {
                            rawData.forEach(item => {
                                const existing = mergedMap.get(item.dateStr) || { dateStr: item.dateStr };
                                mergedMap.set(item.dateStr, { ...existing, [key]: item[key], jsDate: item.dateObj });
                            });
                        }
                    };

                    mergeData(etcRaw, 'etc');
                    mergeData(lprRaw, 'lpr');
                    mergeData(entryLprRaw, 'entryLpr');
                    mergeData(exitLprRaw, 'exitLpr');

                    const mergedArray = Array.from(mergedMap.values())
                        .map((item, index) => ({
                            id: index,
                            date: item.dateStr,
                            jsDate: item.jsDate || parseThaiDate(item.dateStr),
                            etc: item.etc || { total: 0, auto: 0, pAuto: 0, inputEntry: 0, pInputEntry: 0, autoLpr: 0, pAutoLpr: 0, inputLpr: 0, pInputLpr: 0, inputPlaza: 0, pInputPlaza: 0, criteriaSum: 0, passed: false },
                            lpr: item.lpr || { total: 0, auto: 0, pAuto: 0, inputMatch: 0, pInputMatch: 0, inputPlaza: 0, pInputPlaza: 0, criteriaSum: 0, passed: false },
                            entryLpr: item.entryLpr || { total: 0, lprH: 0, lprHPercent: 0, lprL: 0, lprLPercent: 0, passed: false },
                            exitLpr: item.exitLpr || { total: 0, lprH: 0, lprHPercent: 0, lprL: 0, lprLPercent: 0, passed: false }
                        }))
                        .sort((a, b) => (a.jsDate && b.jsDate) ? a.jsDate - b.jsDate : 0);

                    if (mergedArray.length > 0) {
                        setData(mergedArray);
                    }
                }
            }, [etcRaw, lprRaw, entryLprRaw, exitLprRaw]);

            const filteredData = useMemo(() => {
                if (!dateRange.start && !dateRange.end) return data;
                
                const start = dateRange.start ? parseInputDate(dateRange.start) : new Date(0);
                const end = dateRange.end ? parseInputDate(dateRange.end) : new Date(9999, 11, 31);
                end.setHours(23, 59, 59, 999);

                return data.filter(item => {
                    if (!item.jsDate) return false;
                    return item.jsDate >= start && item.jsDate <= end;
                });
            }, [dateRange, data]);

            const stats = useMemo(() => {
                if (filteredData.length === 0) return null;
                const totalEtc = filteredData.reduce((acc, curr) => acc + (curr.etc?.total || 0), 0);
                const totalLpr = filteredData.reduce((acc, curr) => acc + (curr.lpr?.total || 0), 0);
                
                const lprSumAuto = filteredData.reduce((acc, curr) => acc + (curr.lpr?.auto || 0), 0);
                const lprSumInputMatch = filteredData.reduce((acc, curr) => acc + (curr.lpr?.inputMatch || 0), 0);
                const lprSumInputPlaza = filteredData.reduce((acc, curr) => acc + (curr.lpr?.inputPlaza || 0), 0);
                
                const etcSumAuto = filteredData.reduce((acc, curr) => acc + (curr.etc?.auto || 0), 0);
                const etcSumInputEntry = filteredData.reduce((acc, curr) => acc + (curr.etc?.inputEntry || 0), 0);
                const etcSumAutoLpr = filteredData.reduce((acc, curr) => acc + (curr.etc?.autoLpr || 0), 0);
                const etcSumInputLpr = filteredData.reduce((acc, curr) => acc + (curr.etc?.inputLpr || 0), 0);
                const etcSumInputPlaza = filteredData.reduce((acc, curr) => acc + (curr.etc?.inputPlaza || 0), 0);

                const lprGlobalPAuto = totalLpr ? (lprSumAuto / totalLpr) * 100 : 0;
                const lprGlobalPInputMatch = totalLpr ? (lprSumInputMatch / totalLpr) * 100 : 0;
                const lprGlobalPInputPlaza = totalLpr ? (lprSumInputPlaza / totalLpr) * 100 : 0;
                const lprGlobalCriteria = lprGlobalPAuto + lprGlobalPInputMatch;

                const etcGlobalPAuto = totalEtc ? (etcSumAuto / totalEtc) * 100 : 0;
                const etcGlobalPInputEntry = totalEtc ? (etcSumInputEntry / totalEtc) * 100 : 0;
                const etcGlobalPAutoLpr = totalEtc ? (etcSumAutoLpr / totalEtc) * 100 : 0;
                const etcGlobalPInputLpr = totalEtc ? (etcSumInputLpr / totalEtc) * 100 : 0;
                const etcGlobalPInputPlaza = totalEtc ? (etcSumInputPlaza / totalEtc) * 100 : 0;
                const etcGlobalCriteria = etcGlobalPAuto + etcGlobalPInputEntry + etcGlobalPAutoLpr + etcGlobalPInputLpr;

                const totalEntry = filteredData.reduce((acc, curr) => acc + (curr.entryLpr?.total || 0), 0);
                const totalExit = filteredData.reduce((acc, curr) => acc + (curr.exitLpr?.total || 0), 0);
                const entryH = filteredData.reduce((acc, curr) => acc + (curr.entryLpr?.lprH || 0), 0);
                const entryL = filteredData.reduce((acc, curr) => acc + (curr.entryLpr?.lprL || 0), 0);
                const exitH = filteredData.reduce((acc, curr) => acc + (curr.exitLpr?.lprH || 0), 0);
                const exitL = filteredData.reduce((acc, curr) => acc + (curr.exitLpr?.lprL || 0), 0);

                const entryHPercent = totalEntry ? (entryH / totalEntry) * 100 : 0;
                const entryLPercent = totalEntry ? (entryL / totalEntry) * 100 : 0;
                const exitHPercent = totalExit ? (exitH / totalExit) * 100 : 0;
                const exitLPercent = totalExit ? (exitL / totalExit) * 100 : 0;

                return {
                    totalEtc, totalLpr,
                    avgEtcCriteria: etcGlobalCriteria.toFixed(2),
                    avgLprCriteria: lprGlobalCriteria.toFixed(2),
                    lpr: { total: totalLpr, auto: lprSumAuto, pAuto: lprGlobalPAuto, inputMatch: lprSumInputMatch, pInputMatch: lprGlobalPInputMatch, inputPlaza: lprSumInputPlaza, pInputPlaza: lprGlobalPInputPlaza },
                    etc: { total: totalEtc, auto: etcSumAuto, pAuto: etcGlobalPAuto, inputEntry: etcSumInputEntry, pInputEntry: etcGlobalPInputEntry, autoLpr: etcSumAutoLpr, pAutoLpr: etcGlobalPAutoLpr, inputLpr: etcSumInputLpr, pInputLpr: etcGlobalPInputLpr, inputPlaza: etcSumInputPlaza, pInputPlaza: etcGlobalPInputPlaza },
                    entryLpr: { total: totalEntry, lprH: entryH, lprHPercent: entryHPercent, lprL: entryL, lprLPercent: entryLPercent },
                    exitLpr: { total: totalExit, lprH: exitH, lprHPercent: exitHPercent, lprL: exitL, lprLPercent: exitLPercent }
                };
            }, [filteredData]);

            const comparisonData = filteredData.map(d => ({ date: d.date, 'ETC Total': d.etc.total, 'LPR Total': d.lpr.total }));
            const accuracyData = filteredData.map(d => ({ date: d.date, 'Entry LPR (%)': d.entryLpr?.lprHPercent || 0, 'Exit LPR (%)': d.exitLpr?.lprHPercent || 0 }));
            const criteriaData = filteredData.map(d => ({ date: d.date, 'ETC KPI %': parseFloat(d.etc.criteriaSum.toFixed(2)), 'LPR KPI %': parseFloat(d.lpr.criteriaSum.toFixed(2)) }));

            if (!rechartsLoaded) return <div className="flex items-center justify-center min-h-screen"><div className="text-xl font-bold text-blue-600">Loading Dashboard...</div></div>;

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-20">
                    {/* Top Bar */}
                    <div className="bg-slate-800 text-white px-4 py-3 text-sm shadow-md sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
                            <div className="flex items-center gap-3 w-full md:w-auto justify-between md:justify-start">
                                <div className="flex items-center gap-2">
                                    <span className={`w-2.5 h-2.5 rounded-full shadow-lg ${isUsingRealData ? 'bg-green-400' : (autoFetchStatus === 'loading' ? 'bg-blue-400 animate-bounce' : 'bg-yellow-400 animate-pulse')}`}></span>
                                    <span className="font-medium tracking-wide text-xs md:text-sm truncate max-w-[200px] md:max-w-none">
                                        {autoFetchStatus === 'loading' ? 'กำลังดึงข้อมูล...' :
                                         isUsingRealData ? 'โหมดข้อมูลจริง' : 'โหมดรอข้อมูล'}
                                    </span>
                                </div>
                                {/* Mobile Menu Button */}
                                <button className="md:hidden p-1 rounded hover:bg-slate-700" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}>
                                    <IconMenu className="w-6 h-6" />
                                </button>
                            </div>
                            
                            {/* Desktop Upload Buttons */}
                            <div className="hidden md:flex items-center gap-3">
                                {/* Upload buttons here (same as before) */}
                                <label className="flex items-center gap-1 cursor-pointer bg-slate-700 hover:bg-slate-600 px-3 py-1.5 rounded transition-all border border-slate-600 text-xs">
                                    <IconGithub className="w-3 h-3 text-purple-300" /> <span>LPR</span>
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'LPR')} className="hidden" />
                                </label>
                                <label className="flex items-center gap-1 cursor-pointer bg-slate-700 hover:bg-slate-600 px-3 py-1.5 rounded transition-all border border-slate-600 text-xs">
                                    <IconGithub className="w-3 h-3 text-blue-300" /> <span>ETC</span>
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'ETC')} className="hidden" />
                                </label>
                                <label className="flex items-center gap-1 cursor-pointer bg-slate-700 hover:bg-slate-600 px-3 py-1.5 rounded transition-all border border-slate-600 text-xs">
                                    <IconGithub className="w-3 h-3 text-emerald-300" /> <span>Entry</span>
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'EntryLPR')} className="hidden" />
                                </label>
                                <label className="flex items-center gap-1 cursor-pointer bg-slate-700 hover:bg-slate-600 px-3 py-1.5 rounded transition-all border border-slate-600 text-xs">
                                    <IconGithub className="w-3 h-3 text-pink-300" /> <span>Exit</span>
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'ExitLPR')} className="hidden" />
                                </label>
                            </div>
                        </div>
                        
                        {/* Mobile Upload Menu */}
                        {mobileMenuOpen && (
                            <div className="md:hidden mt-3 grid grid-cols-2 gap-2 animate-in slide-in-from-top-2">
                                <label className="flex items-center justify-center gap-2 cursor-pointer bg-slate-700 p-2 rounded text-xs">
                                    <IconGithub className="w-4 h-4 text-purple-300" /> Upload LPR
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'LPR')} className="hidden" />
                                </label>
                                <label className="flex items-center justify-center gap-2 cursor-pointer bg-slate-700 p-2 rounded text-xs">
                                    <IconGithub className="w-4 h-4 text-blue-300" /> Upload ETC
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'ETC')} className="hidden" />
                                </label>
                                <label className="flex items-center justify-center gap-2 cursor-pointer bg-slate-700 p-2 rounded text-xs">
                                    <IconGithub className="w-4 h-4 text-emerald-300" /> Upload Entry
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'EntryLPR')} className="hidden" />
                                </label>
                                <label className="flex items-center justify-center gap-2 cursor-pointer bg-slate-700 p-2 rounded text-xs">
                                    <IconGithub className="w-4 h-4 text-pink-300" /> Upload Exit
                                    <input type="file" accept=".xml" onClick={(e) => (e.target.value = null)} onChange={(e) => handleFileUpload(e, 'ExitLPR')} className="hidden" />
                                </label>
                            </div>
                        )}
                    </div>

                    {/* Navbar Tabs */}
                    <nav className="bg-white border-b border-slate-200 px-4 py-2 sticky top-[56px] z-40 shadow-sm overflow-x-auto whitespace-nowrap scrollbar-hide">
                         <div className="flex space-x-2 md:justify-center">
                            {['overview', 'lpr', 'etc', 'entry', 'exit'].map((tab) => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-1.5 text-xs md:text-sm font-semibold rounded-full transition-all duration-200 ${
                                        activeTab === tab 
                                            ? 'bg-slate-800 text-white shadow-md' 
                                            : 'text-slate-500 hover:bg-slate-100'
                                    }`}
                                >
                                    {tab === 'overview' && 'ภาพรวม'}
                                    {tab === 'lpr' && 'LPR Match'}
                                    {tab === 'etc' && 'ETC Match'}
                                    {tab === 'entry' && 'Entry'}
                                    {tab === 'exit' && 'Exit'}
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-6 md:px-6">
                        
                        {autoFetchStatus === 'error' && (
                            <div className="mb-6 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3 text-red-800 text-xs md:text-sm">
                                <IconInfo className="w-5 h-5 mt-0.5 shrink-0" />
                                <div><p className="font-semibold">ไม่พบข้อมูลอัตโนมัติ</p>ระบบไม่สามารถดึงข้อมูลจาก GitHub ได้ กรุณาใช้วิธีอัปโหลดไฟล์แทน</div>
                            </div>
                        )}

                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6 flex flex-col md:flex-row gap-4 items-end md:items-center">
                            <div className="flex items-center gap-2 w-full md:w-auto text-sm text-slate-600 font-semibold">
                                <IconFilter className="w-4 h-4" /> ตัวกรอง:
                            </div>
                            <div className="grid grid-cols-2 gap-3 w-full md:w-auto md:flex">
                                <div>
                                    <label className="block text-xs text-slate-400 mb-1">จากวันที่</label>
                                    <input type="date" className="w-full border border-slate-300 rounded px-2 py-1.5 text-sm" onChange={(e) => setDateRange(prev => ({ ...prev, start: e.target.value }))} />
                                </div>
                                <div>
                                    <label className="block text-xs text-slate-400 mb-1">ถึงวันที่</label>
                                    <input type="date" className="w-full border border-slate-300 rounded px-2 py-1.5 text-sm" onChange={(e) => setDateRange(prev => ({ ...prev, end: e.target.value }))} />
                                </div>
                            </div>
                            <button onClick={() => setDateRange({ start: '', end: '' })} className="w-full md:w-auto text-xs font-medium text-slate-500 hover:text-blue-600 bg-slate-50 hover:bg-blue-50 px-3 py-2 rounded transition-colors ml-auto">ล้างค่า</button>
                        </div>

                        {!stats ? (
                            <div className="flex flex-col items-center justify-center py-16 bg-white rounded-xl border-2 border-dashed border-slate-200 text-slate-400">
                                <IconFileText className="w-10 h-10 mb-2 opacity-50" />
                                <p className="text-sm">ไม่พบข้อมูลในช่วงเวลานี้</p>
                            </div>
                        ) : (
                            <>
                                {activeTab === 'overview' && (
                                    <div className="space-y-6 animate-in fade-in duration-300">
                                        
                                        {/* 1. LPR Matching Section */}
                                        <div className="space-y-3">
                                            <h3 className="text-base font-bold text-purple-700 flex items-center gap-2"><span className="w-1 h-5 bg-purple-600 rounded-full"></span> LPR Matching</h3>
                                            <div className="grid grid-cols-2 md:grid-cols-2 gap-3">
                                                <StatCard title="Total Transactions" value={stats.totalLpr.toLocaleString()} subValue="รายการ" icon={IconActivity} colorClass="text-blue-600" />
                                                <StatCard title="Avg KPI Score" value={`${stats.avgLprCriteria}%`} subValue="Target > 90.25%" icon={IconCheckCircle} colorClass="text-blue-600" />
                                            </div>
                                        </div>

                                        {/* 2. ETC Matching Section */}
                                        <div className="space-y-3 pt-4 border-t border-slate-100">
                                            <h3 className="text-base font-bold text-orange-700 flex items-center gap-2"><span className="w-1 h-5 bg-orange-600 rounded-full"></span> ETC Matching</h3>
                                            <div className="grid grid-cols-2 md:grid-cols-2 gap-3">
                                                <StatCard title="Total Transactions" value={stats.totalEtc.toLocaleString()} subValue="รายการ" icon={IconActivity} colorClass="text-orange-600" />
                                                <StatCard title="Avg KPI Score" value={`${stats.avgEtcCriteria}%`} subValue="Target > 98%" icon={IconCheckCircle} colorClass="text-orange-600" />
                                            </div>
                                        </div>

                                        {/* Charts */}
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                                <h3 className="text-sm font-bold text-slate-700 mb-4">ปริมาณจราจร (Volume)</h3>
                                                <div className="h-64"><ResponsiveContainer width="100%" height="100%"><AreaChart data={comparisonData} margin={{left: -20}}><defs><linearGradient id="colorEtc" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#ea580c" stopOpacity={0.1}/><stop offset="95%" stopColor="#ea580c" stopOpacity={0}/></linearGradient><linearGradient id="colorLpr" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#2563eb" stopOpacity={0.1}/><stop offset="95%" stopColor="#2563eb" stopOpacity={0}/></linearGradient></defs><CartesianGrid strokeDasharray="3 3" vertical={false} /><XAxis dataKey="date" tick={<CustomAxisTick />} /><YAxis tick={{fontSize: 10}} /><Tooltip content={<CustomRechartsTooltip />} /><Area type="monotone" dataKey="ETC Total" stroke="#ea580c" fill="url(#colorEtc)" /><Area type="monotone" dataKey="LPR Total" stroke="#2563eb" fill="url(#colorLpr)" /></AreaChart></ResponsiveContainer></div>
                                            </div>
                                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                                <h3 className="text-sm font-bold text-slate-700 mb-4">แนวโน้ม KPI (Trend)</h3>
                                                <div className="h-64"><ResponsiveContainer width="100%" height="100%"><LineChart data={criteriaData} margin={{left: -20}}><CartesianGrid strokeDasharray="3 3" vertical={false} /><XAxis dataKey="date" tick={<CustomAxisTick />} /><YAxis domain={[80, 100]} tick={{fontSize: 10}} /><Tooltip content={<CustomRechartsTooltip />} /><Legend /><Line type="monotone" dataKey="ETC KPI %" stroke="#ea580c" strokeWidth={2} dot={false} /><Line type="monotone" dataKey="LPR KPI %" stroke="#2563eb" strokeWidth={2} dot={false} /></LineChart></ResponsiveContainer></div>
                                            </div>
                                        </div>

                                        {/* 3. Entry & Exit Overview */}
                                        <div className="space-y-3 pt-4 border-t border-slate-100">
                                            <h3 className="text-base font-bold text-teal-700 flex items-center gap-2"><span className="w-1 h-5 bg-teal-600 rounded-full"></span> Entry & Exit LPR</h3>
                                            <div className="grid grid-cols-2 lg:grid-cols-4 gap-3">
                                                <StatCard title="Entry Total" value={stats.entryLpr.total.toLocaleString()} subValue="รายการ" icon={IconActivity} colorClass="text-emerald-600" />
                                                <StatCard title="Entry Accuracy" value={`${stats.entryLpr.lprHPercent.toFixed(2)}%`} subValue="> 95%" icon={IconCheckCircle} colorClass="text-emerald-600" />
                                                <StatCard title="Exit Total" value={stats.exitLpr.total.toLocaleString()} subValue="รายการ" icon={IconActivity} colorClass="text-pink-600" />
                                                <StatCard title="Exit Accuracy" value={`${stats.exitLpr.lprHPercent.toFixed(2)}%`} subValue="> 95%" icon={IconCheckCircle} colorClass="text-pink-600" />
                                            </div>
                                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mt-4">
                                                <div className="h-64"><ResponsiveContainer width="100%" height="100%"><LineChart data={accuracyData} margin={{left: -20}}><CartesianGrid strokeDasharray="3 3" vertical={false} /><XAxis dataKey="date" tick={<CustomAxisTick />} /><YAxis domain={[90, 100]} tick={{fontSize: 10}} /><Tooltip content={<CustomRechartsTooltip />} /><Legend /><Line type="monotone" dataKey="Entry LPR (%)" stroke="#10b981" strokeWidth={2} dot={false} /><Line type="monotone" dataKey="Exit LPR (%)" stroke="#f43f5e" strokeWidth={2} dot={false} /></LineChart></ResponsiveContainer></div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'lpr' && (
                                    <div className="space-y-6 animate-in fade-in duration-300">
                                        {/* Mobile: Card View / Desktop: Table View */}
                                        {isMobile ? (
                                            <div>
                                                {filteredData.map(row => <MobileTableRowCard key={row.id} row={row} type="lpr" />)}
                                            </div>
                                        ) : (
                                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                                <div className="overflow-x-auto custom-scrollbar">
                                                    <table className="w-full text-xs text-left whitespace-nowrap">
                                                        <thead className="bg-slate-50 text-slate-600 font-semibold border-b uppercase tracking-wider text-[11px]">
                                                            <tr>
                                                                <th rowSpan="2" className="px-4 py-3 border-r text-center text-sm">วันที่</th>
                                                                <th rowSpan="2" className="px-4 py-3 border-r text-center text-sm">Total</th>
                                                                <th colSpan="2" className="px-2 py-1 border-b border-r text-center bg-purple-50 text-purple-900">Auto Match</th>
                                                                <th colSpan="2" className="px-2 py-1 border-b border-r text-center bg-teal-50 text-teal-900">Input LPR</th>
                                                                <th colSpan="2" className="px-2 py-1 border-b border-r text-center bg-amber-50 text-amber-900">Input Plaza</th>
                                                                <th rowSpan="2" className="px-4 py-3 border-r text-center">KPI (%)</th>
                                                                <th rowSpan="2" className="px-4 py-3 text-center">Status</th>
                                                            </tr>
                                                            <tr>
                                                                <th className="px-2 py-1 text-center border-r bg-purple-50/50">Total</th>
                                                                <th className="px-2 py-1 text-center border-r bg-purple-50/50">%</th>
                                                                <th className="px-2 py-1 text-center border-r bg-teal-50/50">Total</th>
                                                                <th className="px-2 py-1 text-center border-r bg-teal-50/50">%</th>
                                                                <th className="px-2 py-1 text-center border-r bg-amber-50/50">Total</th>
                                                                <th className="px-2 py-1 text-center border-r bg-amber-50/50">%</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="divide-y divide-slate-100">
                                                            {filteredData.map(row => (
                                                                <tr key={row.id} className="hover:bg-slate-50">
                                                                    <td className="px-4 py-3 font-medium text-center">{row.date}</td>
                                                                    <td className="px-4 py-3 font-mono text-center">{row.lpr.total.toLocaleString()}</td>
                                                                    <td className="px-2 py-3 text-center font-mono text-purple-700 bg-purple-50/20">{row.lpr.auto.toLocaleString()}</td>
                                                                    <td className="px-2 py-3 text-center font-bold text-purple-700 bg-purple-50/20">{row.lpr.pAuto.toFixed(2)}%</td>
                                                                    <td className="px-2 py-3 text-center font-mono text-teal-700 bg-teal-50/20">{row.lpr.inputMatch.toLocaleString()}</td>
                                                                    <td className="px-2 py-3 text-center font-bold text-teal-700 bg-teal-50/20">{row.lpr.pInputMatch.toFixed(2)}%</td>
                                                                    <td className="px-2 py-3 text-center font-mono text-amber-700 bg-amber-50/20">{row.lpr.inputPlaza.toLocaleString()}</td>
                                                                    <td className="px-2 py-3 text-center font-bold text-amber-700 bg-amber-50/20">{row.lpr.pInputPlaza.toFixed(2)}%</td>
                                                                    <td className="px-4 py-3 text-center font-bold">{row.lpr.criteriaSum.toFixed(2)}%</td>
                                                                    <td className="px-4 py-3 text-center"><StatusBadge passed={row.lpr.passed} /></td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* ETC Tab: Similar Structure with Mobile Card Support */}
                                {activeTab === 'etc' && (
                                    <div className="space-y-6 animate-in fade-in duration-300">
                                        {isMobile ? (
                                            <div>{filteredData.map(row => <MobileTableRowCard key={row.id} row={row} type="etc" />)}</div>
                                        ) : (
                                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                                <div className="overflow-x-auto custom-scrollbar">
                                                    <table className="w-full text-xs text-left whitespace-nowrap table-compact">
                                                        <thead className="bg-slate-50 text-slate-600 font-semibold border-b uppercase tracking-wider text-[10px]">
                                                            <tr>
                                                                <th rowSpan="2" className="py-3 px-2 border-r text-center text-sm">วันที่</th>
                                                                <th rowSpan="2" className="py-3 px-2 border-r text-center text-sm">Total</th>
                                                                <th colSpan="2" className="py-1 px-1 border-b border-r text-center bg-blue-100 text-blue-900">Auto</th>
                                                                <th colSpan="2" className="py-1 px-1 border-b border-r text-center bg-emerald-100 text-emerald-900">Handheld</th>
                                                                <th colSpan="2" className="py-1 px-1 border-b border-r text-center bg-orange-100 text-orange-900">Auto LPR</th>
                                                                <th colSpan="2" className="py-1 px-1 border-b border-r text-center bg-indigo-100 text-indigo-900">In. LPR</th>
                                                                <th colSpan="2" className="py-1 px-1 border-b border-r text-center bg-gray-100 text-gray-900">In. Plaza</th>
                                                                <th rowSpan="2" className="py-3 px-2 border-r text-center">KPI(%)</th>
                                                                <th rowSpan="2" className="py-3 px-2 text-center">Status</th>
                                                            </tr>
                                                            <tr>
                                                                {/* Sub-headers for Total/% repeated */}
                                                                {[...Array(5)].map((_, i) => (
                                                                    <React.Fragment key={i}>
                                                                        <th className="py-1 px-1 text-center border-r bg-slate-50/50">Total</th>
                                                                        <th className="py-1 px-1 text-center border-r bg-slate-50/50">%</th>
                                                                    </React.Fragment>
                                                                ))}
                                                            </tr>
                                                        </thead>
                                                        <tbody className="divide-y divide-slate-100">
                                                            {filteredData.map(row => (
                                                                <tr key={row.id} className="hover:bg-slate-50">
                                                                    <td className="py-2 text-center font-medium">{row.date}</td>
                                                                    <td className="py-2 text-center font-mono">{row.etc.total.toLocaleString()}</td>
                                                                    <td className="py-2 text-center font-mono text-blue-700 bg-blue-50/20">{row.etc.auto.toLocaleString()}</td>
                                                                    <td className="py-2 text-center font-bold text-blue-700 bg-blue-50/20">{row.etc.pAuto.toFixed(2)}%</td>
                                                                    <td className="py-2 text-center font-mono text-emerald-700 bg-emerald-50/20">{row.etc.inputEntry.toLocaleString()}</td>
                                                                    <td className="py-2 text-center font-bold text-emerald-700 bg-emerald-50/20">{row.etc.pInputEntry.toFixed(2)}%</td>
                                                                    <td className="py-2 text-center font-mono text-orange-700 bg-orange-50/20">{row.etc.autoLpr.toLocaleString()}</td>
                                                                    <td className="py-2 text-center font-bold text-orange-700 bg-orange-50/20">{row.etc.pAutoLpr.toFixed(2)}%</td>
                                                                    <td className="py-2 text-center font-mono text-indigo-700 bg-indigo-50/20">{row.etc.inputLpr.toLocaleString()}</td>
                                                                    <td className="py-2 text-center font-bold text-indigo-700 bg-indigo-50/20">{row.etc.pInputLpr.toFixed(2)}%</td>
                                                                    <td className="py-2 text-center font-mono text-gray-600 bg-gray-50/20">{row.etc.inputPlaza.toLocaleString()}</td>
                                                                    <td className="py-2 text-center font-bold text-gray-600 bg-gray-50/20">{row.etc.pInputPlaza.toFixed(2)}%</td>
                                                                    <td className="py-2 text-center font-bold">{row.etc.criteriaSum.toFixed(2)}%</td>
                                                                    <td className="py-2 text-center"><StatusBadge passed={row.etc.passed} /></td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {['entry', 'exit'].map(type => (
                                    activeTab === type && (
                                        <div key={type} className="space-y-6 animate-in fade-in duration-300">
                                            {isMobile ? (
                                                <div>{filteredData.map(row => <MobileTableRowCard key={row.id} row={row} type={type} />)}</div>
                                            ) : (
                                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                                    <div className="overflow-x-auto custom-scrollbar">
                                                        <table className="w-full text-xs text-left whitespace-nowrap">
                                                            <thead className="bg-slate-50 text-slate-600 font-semibold border-b uppercase tracking-wider text-[11px]">
                                                                <tr>
                                                                    <th className="px-6 py-4 text-center">วันที่</th>
                                                                    <th className="px-6 py-4 text-right">Total</th>
                                                                    <th className={`px-6 py-4 text-right ${type === 'entry' ? 'bg-emerald-50 text-emerald-900' : 'bg-emerald-50 text-emerald-900'}`}>LPR &gt; 95%</th>
                                                                    <th className={`px-6 py-4 text-right ${type === 'entry' ? 'bg-emerald-50 text-emerald-900' : 'bg-emerald-50 text-emerald-900'}`}>%</th>
                                                                    <th className="px-6 py-4 text-right bg-rose-50 text-rose-900">LPR &lt; 95%</th>
                                                                    <th className="px-6 py-4 text-right bg-rose-50 text-rose-900">%</th>
                                                                    <th className="px-6 py-4 text-center">Status</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody className="divide-y divide-slate-100">
                                                                {filteredData.map(row => {
                                                                    const item = row[`${type}Lpr`];
                                                                    if (!item) return null;
                                                                    return (
                                                                        <tr key={row.id} className="hover:bg-slate-50">
                                                                            <td className="px-6 py-3.5 font-medium text-center">{row.date}</td>
                                                                            <td className="px-6 py-3.5 text-right font-mono">{item.total.toLocaleString()}</td>
                                                                            <td className={`px-6 py-3.5 text-right font-mono ${type === 'entry' ? 'bg-emerald-50/30 text-emerald-700' : 'bg-emerald-50/30 text-emerald-700'}`}>{item.lprH.toLocaleString()}</td>
                                                                            <td className={`px-6 py-3.5 text-right font-bold ${type === 'entry' ? 'bg-emerald-50/30 text-emerald-700' : 'bg-emerald-50/30 text-emerald-700'}`}>{item.lprHPercent.toFixed(2)}%</td>
                                                                            <td className="px-6 py-3.5 text-right font-mono bg-rose-50/30 text-rose-700">{item.lprL.toLocaleString()}</td>
                                                                            <td className="px-6 py-3.5 text-right font-bold bg-rose-50/30 text-rose-700">{item.lprLPercent.toFixed(2)}%</td>
                                                                            <td className="px-6 py-3.5 text-center"><StatusBadge passed={item.passed} /></td>
                                                                        </tr>
                                                                    );
                                                                })}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )
                                ))}
                            </>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>
